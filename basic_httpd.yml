#
# Basic httpd settings
#
---
- hosts: all

  vars_files:
    - networks.yml

  tasks:

  - name: Install apache
    yum: name=httpd
         state=installed
    tags:
      - packages

  - name: Install apachetop
    yum: name=apachetop
         state=installed
    tags:
      - packages

  - name: Install /var/www/html/index.html
    template: src=var/www/html/index.html.j2
              dest=/var/www/html/index.html
              owner=root
              group=root
              mode=0644
    tags:
      - index
      - config

  - name: Enable HTTP server status
    template: src=etc/httpd/conf.d/status.conf.j2
              dest=/etc/httpd/conf.d/status.conf
              owner=root
              group=root
              mode=0644
    notify:
      - Restart httpd
    tags:
      - config

  - name: Set HTTP server name
    template: src=etc/httpd/conf.d/servername.conf.j2
              dest=/etc/httpd/conf.d/servername.conf
              owner=root
              group=root
              mode=0644
    notify:
      - Restart httpd
    tags:
      - config

  - name: Set JSON sytle error documents
    template: src=etc/httpd/conf.d/error.conf.j2
              dest=/etc/httpd/conf.d/error.conf
              owner=root
              group=root
              mode=0644
    notify:
      - Restart httpd
    tags:
      - config
      - error

  - name: Allow HTTP connect
    seboolean: name=httpd_can_network_connect
               state=true
               persistent=yes
    notify:
      - Restart httpd
    tags:
      - selinux

#  - name: Put HTTP in permissive mode
#    command: /usr/sbin/semanage permissive -a httpd_t

  - name: Start httpd
    service: name=httpd
             state=started

  handlers:
    - name: Restart httpd
      service: name=httpd
               state=restarted
